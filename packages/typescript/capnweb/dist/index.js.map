{"version":3,"sources":["../src/index.ts"],"names":["RpcMessageType","TransportState"],"mappings":";AA8DO,IAAW,cAAA,qBAAAA,eAAAA,KAAX;AACL,EAAAA,eAAAA,CAAAA,eAAAA,CAAA,UAAO,CAAA,CAAA,GAAP,MAAA;AACA,EAAAA,eAAAA,CAAAA,eAAAA,CAAA,YAAS,CAAA,CAAA,GAAT,QAAA;AACA,EAAAA,eAAAA,CAAAA,eAAAA,CAAA,YAAS,CAAA,CAAA,GAAT,QAAA;AACA,EAAAA,eAAAA,CAAAA,eAAAA,CAAA,aAAU,CAAA,CAAA,GAAV,SAAA;AACA,EAAAA,eAAAA,CAAAA,eAAAA,CAAA,aAAU,CAAA,CAAA,GAAV,SAAA;AACA,EAAAA,eAAAA,CAAAA,eAAAA,CAAA,gBAAa,CAAA,CAAA,GAAb,YAAA;AACA,EAAAA,eAAAA,CAAAA,eAAAA,CAAA,eAAY,CAAA,CAAA,GAAZ,WAAA;AACA,EAAAA,eAAAA,CAAAA,eAAAA,CAAA,WAAQ,CAAA,CAAA,GAAR,OAAA;AARgB,EAAA,OAAAA,eAAAA;AAAA,CAAA,EAAA,cAAA,IAAA,EAAA;AA4FX,IAAW,cAAA,qBAAAC,eAAAA,KAAX;AACL,EAAAA,gBAAA,YAAA,CAAA,GAAa,YAAA;AACb,EAAAA,gBAAA,WAAA,CAAA,GAAY,WAAA;AACZ,EAAAA,gBAAA,cAAA,CAAA,GAAe,cAAA;AACf,EAAAA,gBAAA,QAAA,CAAA,GAAS,QAAA;AAJO,EAAA,OAAAA,eAAAA;AAAA,CAAA,EAAA,cAAA,IAAA,EAAA;AAiFX,SAAS,cAAc,QAAA,EAAmC;AAE/D,EAAA,MAAM,IAAI,MAAM,gCAAgC,CAAA;AAClD;AAKO,SAAS,cAAc,KAAA,EAAgC;AAE5D,EAAA,MAAM,IAAI,MAAM,gCAAgC,CAAA;AAClD;AAKO,SAAS,oBAAA,GAAuC;AACrD,EAAA,OAAO,IAAI,cAAA,EAAe;AAC5B;AAKO,IAAM,iBAAN,MAAqB;AAAA,EAClB,WAAsB,EAAC;AAAA,EAE/B,WAAW,IAAA,EAAyB;AAClC,IAAA,IAAA,CAAK,SAAS,IAAA,CAAK,EAAE,MAAM,UAAA,EAAY,IAAA,CAAK,YAAY,CAAA;AACxD,IAAA,OAAO,IAAA;AAAA,EACT;AAAA,EAEA,KAAA,GAAiB;AACf,IAAA,MAAM,SAAA,GAAY,IAAA,CAAK,QAAA,CAAS,MAAA,CAAO,CAAC,KAAK,GAAA,KAAQ,GAAA,GAAM,GAAA,CAAI,UAAA,EAAY,CAAC,CAAA;AAC5E,IAAA,OAAO;AAAA,MACL,UAAU,MAAA,CAAO,MAAA,CAAO,CAAC,GAAG,IAAA,CAAK,QAAQ,CAAC,CAAA;AAAA,MAC1C;AAAA,KACF;AAAA,EACF;AAAA,EAEA,KAAA,GAAc;AACZ,IAAA,IAAA,CAAK,WAAW,EAAC;AACjB,IAAA,OAAO,IAAA;AAAA,EACT;AACF;AAiBO,IAAM,SAAA,GAAY;AAAA;AAAA,EAEvB,gBAAA,EAAkB,IAAA;AAAA;AAAA,EAGlB,SAAA,EAAW,IAAA;AAAA;AAAA,EAGX,aAAA,EAAe,IAAA;AAAA;AAAA,EAGf,gBAAA,EAAkB,IAAA;AAAA;AAAA,EAGlB,mBAAA,EAAqB;AACvB;AAOO,IAAM,aAAA,GAA+C;AAAA,EAC1D,CAAC,SAAA,CAAU,gBAAgB,GAAG,kBAAA;AAAA,EAC9B,CAAC,SAAA,CAAU,SAAS,GAAG,WAAA;AAAA,EACvB,CAAC,SAAA,CAAU,aAAa,GAAG,eAAA;AAAA,EAC3B,CAAC,SAAA,CAAU,gBAAgB,GAAG,kBAAA;AAAA,EAC9B,CAAC,SAAA,CAAU,mBAAmB,GAAG;AACnC;AA+BO,IAAM,YAAA,GAAN,cAA2B,KAAA,CAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOtC,WAAA,CACE,OAAA,EACgB,IAAA,EACA,QAAA,EAChB;AACA,IAAA,KAAA,CAAM,OAAO,CAAA;AAHG,IAAA,IAAA,CAAA,IAAA,GAAA,IAAA;AACA,IAAA,IAAA,CAAA,QAAA,GAAA,QAAA;AAGhB,IAAA,IAAA,CAAK,IAAA,GAAO,cAAA;AAAA,EACd;AAAA;AAAA;AAAA;AAAA,EAKA,MAAA,GAA4E;AAC1E,IAAA,OAAO;AAAA,MACL,MAAM,IAAA,CAAK,IAAA;AAAA,MACX,SAAS,IAAA,CAAK,OAAA;AAAA,MACd,MAAM,IAAA,CAAK,IAAA;AAAA,MACX,UAAU,IAAA,CAAK;AAAA,KACjB;AAAA,EACF;AACF;AAyBO,IAAM,eAAA,GAAN,cAA8B,YAAA,CAAa;AAAA;AAAA;AAAA;AAAA;AAAA,EAKhD,YAAY,OAAA,EAAiB;AAC3B,IAAA,KAAA,CAAM,OAAA,EAAS,SAAA,CAAU,gBAAA,EAAkB,kBAAkB,CAAA;AAC7D,IAAA,IAAA,CAAK,IAAA,GAAO,iBAAA;AAAA,EACd;AACF;AA2BO,IAAM,QAAA,GAAN,cAAuB,YAAA,CAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMzC,WAAA,CACE,SACgB,QAAA,EAChB;AACA,IAAA,KAAA,CAAM,OAAA,EAAS,SAAA,CAAU,SAAA,EAAW,WAAW,CAAA;AAF/B,IAAA,IAAA,CAAA,QAAA,GAAA,QAAA;AAGhB,IAAA,IAAA,CAAK,IAAA,GAAO,UAAA;AAAA,EACd;AACF;AAyBO,IAAM,YAAA,GAAN,cAA2B,YAAA,CAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAM7C,WAAA,CACE,OAAA,GAAkB,mBAAA,EACF,SAAA,EAChB;AACA,IAAA,KAAA,CAAM,OAAA,EAAS,SAAA,CAAU,aAAA,EAAe,eAAe,CAAA;AAFvC,IAAA,IAAA,CAAA,SAAA,GAAA,SAAA;AAGhB,IAAA,IAAA,CAAK,IAAA,GAAO,cAAA;AAAA,EACd;AACF;AA4BO,IAAM,eAAA,GAAN,cAA8B,YAAA,CAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMhD,WAAA,CACE,SACgB,YAAA,EAChB;AACA,IAAA,KAAA,CAAM,OAAA,EAAS,SAAA,CAAU,gBAAA,EAAkB,kBAAkB,CAAA;AAF7C,IAAA,IAAA,CAAA,YAAA,GAAA,YAAA;AAGhB,IAAA,IAAA,CAAK,IAAA,GAAO,iBAAA;AAAA,EACd;AACF;AAwBO,IAAM,kBAAA,GAAN,cAAiC,YAAA,CAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMnD,WAAA,CACE,OAAA,EACgB,aAAA,GAAyB,KAAA,EACzC;AACA,IAAA,KAAA,CAAM,OAAA,EAAS,SAAA,CAAU,mBAAA,EAAqB,qBAAqB,CAAA;AAFnD,IAAA,IAAA,CAAA,aAAA,GAAA,aAAA;AAGhB,IAAA,IAAA,CAAK,IAAA,GAAO,oBAAA;AAAA,EACd;AACF;AAwBO,SAAS,WAAA,CAAY,OAAgB,IAAA,EAA8B;AACxE,EAAA,OAAO,KAAA,YAAiB,YAAA,IAAgB,KAAA,CAAM,IAAA,KAAS,IAAA;AACzD;AASO,SAAS,WAAA,CAAY,MAAqB,OAAA,EAA+B;AAC9E,EAAA,QAAQ,IAAA;AAAM,IACZ,KAAK,SAAA,CAAU,gBAAA;AACb,MAAA,OAAO,IAAI,gBAAgB,OAAO,CAAA;AAAA,IACpC,KAAK,SAAA,CAAU,SAAA;AACb,MAAA,OAAO,IAAI,SAAS,OAAO,CAAA;AAAA,IAC7B,KAAK,SAAA,CAAU,aAAA;AACb,MAAA,OAAO,IAAI,aAAa,OAAO,CAAA;AAAA,IACjC,KAAK,SAAA,CAAU,gBAAA;AACb,MAAA,OAAO,IAAI,gBAAgB,OAAO,CAAA;AAAA,IACpC,KAAK,SAAA,CAAU,mBAAA;AACb,MAAA,OAAO,IAAI,mBAAmB,OAAO,CAAA;AAAA,IACvC;AACE,MAAA,OAAO,IAAI,YAAA,CAAa,OAAA,EAAS,MAAM,aAAA,CAAc,IAAI,KAAK,eAAe,CAAA;AAAA;AAEnF;AASO,SAAS,SAAA,CACd,KAAA,EACA,WAAA,GAA6B,SAAA,CAAU,SAAA,EACzB;AACd,EAAA,IAAI,iBAAiB,YAAA,EAAc;AACjC,IAAA,OAAO,KAAA;AAAA,EACT;AACA,EAAA,IAAI,iBAAiB,KAAA,EAAO;AAC1B,IAAA,OAAO,WAAA,CAAY,WAAA,EAAa,KAAA,CAAM,OAAO,CAAA;AAAA,EAC/C;AACA,EAAA,OAAO,WAAA,CAAY,WAAA,EAAa,MAAA,CAAO,KAAK,CAAC,CAAA;AAC/C","file":"index.js","sourcesContent":["/**\n * @dotdo/capnweb - Cap'n Proto over WebTransport\n * Core protocol types and low-level primitives\n */\n\n// ============================================================================\n// Message Types\n// ============================================================================\n\n/**\n * Unique identifier for a capability\n */\nexport type CapabilityId = number;\n\n/**\n * Message ID for request/response correlation\n */\nexport type MessageId = number;\n\n/**\n * Segment of a Cap'n Proto message\n */\nexport interface Segment {\n  readonly data: ArrayBuffer;\n  readonly byteLength: number;\n}\n\n/**\n * A Cap'n Proto message consisting of segments\n */\nexport interface Message {\n  readonly segments: readonly Segment[];\n  readonly totalSize: number;\n}\n\n// ============================================================================\n// Capability Types\n// ============================================================================\n\n/**\n * Reference to a remote capability\n */\nexport interface CapabilityRef {\n  readonly id: CapabilityId;\n  readonly interfaceId: bigint;\n  readonly methodCount: number;\n}\n\n/**\n * Promise for a capability that may not yet be resolved\n */\nexport interface CapabilityPromise {\n  readonly id: CapabilityId;\n  readonly resolved: boolean;\n  resolve(ref: CapabilityRef): void;\n  reject(error: Error): void;\n}\n\n// ============================================================================\n// RPC Message Types\n// ============================================================================\n\nexport const enum RpcMessageType {\n  Call = 0,\n  Return = 1,\n  Finish = 2,\n  Resolve = 3,\n  Release = 4,\n  Disembargo = 5,\n  Bootstrap = 6,\n  Abort = 7,\n}\n\n/**\n * Method call request\n */\nexport interface CallMessage {\n  readonly type: RpcMessageType.Call;\n  readonly questionId: MessageId;\n  readonly target: CapabilityId;\n  readonly interfaceId: bigint;\n  readonly methodId: number;\n  readonly params: Message;\n}\n\n/**\n * Method call response\n */\nexport interface ReturnMessage {\n  readonly type: RpcMessageType.Return;\n  readonly answerId: MessageId;\n  readonly result: Message | Error;\n  readonly releaseParamCaps: boolean;\n}\n\n/**\n * Finish a question (release answer)\n */\nexport interface FinishMessage {\n  readonly type: RpcMessageType.Finish;\n  readonly questionId: MessageId;\n  readonly releaseResultCaps: boolean;\n}\n\n/**\n * Resolve a promise capability\n */\nexport interface ResolveMessage {\n  readonly type: RpcMessageType.Resolve;\n  readonly promiseId: CapabilityId;\n  readonly resolution: CapabilityRef | Error;\n}\n\n/**\n * Release a capability reference\n */\nexport interface ReleaseMessage {\n  readonly type: RpcMessageType.Release;\n  readonly id: CapabilityId;\n  readonly referenceCount: number;\n}\n\n/**\n * Bootstrap request for initial capability\n */\nexport interface BootstrapMessage {\n  readonly type: RpcMessageType.Bootstrap;\n  readonly questionId: MessageId;\n}\n\n/**\n * Abort the connection\n */\nexport interface AbortMessage {\n  readonly type: RpcMessageType.Abort;\n  readonly reason: string;\n}\n\nexport type RpcMessage =\n  | CallMessage\n  | ReturnMessage\n  | FinishMessage\n  | ResolveMessage\n  | ReleaseMessage\n  | BootstrapMessage\n  | AbortMessage;\n\n// ============================================================================\n// Transport Types\n// ============================================================================\n\n/**\n * Transport state\n */\nexport const enum TransportState {\n  Connecting = 'connecting',\n  Connected = 'connected',\n  Disconnected = 'disconnected',\n  Failed = 'failed',\n}\n\n/**\n * Transport events\n */\nexport interface TransportEvents {\n  message: (message: RpcMessage) => void;\n  connected: () => void;\n  disconnected: (reason?: string) => void;\n  error: (error: Error) => void;\n}\n\n/**\n * Low-level transport interface for Cap'n Proto messages\n */\nexport interface Transport {\n  readonly state: TransportState;\n  readonly url: string;\n\n  send(message: RpcMessage): Promise<void>;\n  close(reason?: string): Promise<void>;\n\n  on<K extends keyof TransportEvents>(event: K, handler: TransportEvents[K]): void;\n  off<K extends keyof TransportEvents>(event: K, handler: TransportEvents[K]): void;\n}\n\n// ============================================================================\n// Connection Types\n// ============================================================================\n\n/**\n * Options for establishing a connection\n */\nexport interface ConnectionOptions {\n  /** Target URL (webtransport:// or https://) */\n  url: string;\n  /** Connection timeout in milliseconds */\n  timeout?: number;\n  /** Enable automatic reconnection */\n  autoReconnect?: boolean;\n  /** Maximum reconnection attempts */\n  maxReconnectAttempts?: number;\n  /** Base delay for reconnection backoff (ms) */\n  reconnectDelay?: number;\n}\n\n/**\n * Connection statistics\n */\nexport interface ConnectionStats {\n  readonly messagesIn: number;\n  readonly messagesOut: number;\n  readonly bytesIn: number;\n  readonly bytesOut: number;\n  readonly latencyMs: number;\n  readonly uptime: number;\n}\n\n/**\n * A connection to a Cap'n Proto server\n */\nexport interface Connection {\n  readonly state: TransportState;\n  readonly stats: ConnectionStats;\n\n  bootstrap<T>(): Promise<T>;\n  close(reason?: string): Promise<void>;\n}\n\n// ============================================================================\n// Serialization Utilities\n// ============================================================================\n\n/**\n * Encode an RPC message to bytes\n */\nexport function encodeMessage(_message: RpcMessage): ArrayBuffer {\n  // Stub implementation - actual implementation would use Cap'n Proto encoding\n  throw new Error('Not implemented: encodeMessage');\n}\n\n/**\n * Decode bytes to an RPC message\n */\nexport function decodeMessage(_data: ArrayBuffer): RpcMessage {\n  // Stub implementation - actual implementation would use Cap'n Proto decoding\n  throw new Error('Not implemented: decodeMessage');\n}\n\n/**\n * Create a new message builder\n */\nexport function createMessageBuilder(): MessageBuilder {\n  return new MessageBuilder();\n}\n\n/**\n * Builder for constructing Cap'n Proto messages\n */\nexport class MessageBuilder {\n  private segments: Segment[] = [];\n\n  addSegment(data: ArrayBuffer): this {\n    this.segments.push({ data, byteLength: data.byteLength });\n    return this;\n  }\n\n  build(): Message {\n    const totalSize = this.segments.reduce((sum, seg) => sum + seg.byteLength, 0);\n    return {\n      segments: Object.freeze([...this.segments]),\n      totalSize,\n    };\n  }\n\n  clear(): this {\n    this.segments = [];\n    return this;\n  }\n}\n\n// ============================================================================\n// Standard Error Codes\n// ============================================================================\n\n/**\n * Standard error codes used across all DotDo SDK implementations.\n * These codes are consistent across TypeScript, Python, Rust, and Go.\n *\n * Error Code Ranges:\n * - 1xxx: Connection errors\n * - 2xxx: RPC errors\n * - 3xxx: Timeout errors\n * - 4xxx: Capability errors\n * - 5xxx: Serialization errors\n */\nexport const ErrorCode = {\n  /** Connection-related errors (network, transport) */\n  CONNECTION_ERROR: 1001,\n\n  /** RPC method call failures */\n  RPC_ERROR: 2001,\n\n  /** Request timeout exceeded */\n  TIMEOUT_ERROR: 3001,\n\n  /** Capability resolution or access errors */\n  CAPABILITY_ERROR: 4001,\n\n  /** Serialization/deserialization errors */\n  SERIALIZATION_ERROR: 5001,\n} as const;\n\nexport type ErrorCodeType = (typeof ErrorCode)[keyof typeof ErrorCode];\n\n/**\n * Maps error codes to their string names\n */\nexport const ErrorCodeName: Record<ErrorCodeType, string> = {\n  [ErrorCode.CONNECTION_ERROR]: 'CONNECTION_ERROR',\n  [ErrorCode.RPC_ERROR]: 'RPC_ERROR',\n  [ErrorCode.TIMEOUT_ERROR]: 'TIMEOUT_ERROR',\n  [ErrorCode.CAPABILITY_ERROR]: 'CAPABILITY_ERROR',\n  [ErrorCode.SERIALIZATION_ERROR]: 'SERIALIZATION_ERROR',\n};\n\n// ============================================================================\n// Error Types\n// ============================================================================\n\n/**\n * Base error class for all capnweb/RPC errors.\n *\n * All error types in the DotDo ecosystem extend this class, allowing you to\n * catch all RPC-related errors with a single catch block.\n *\n * Error Hierarchy:\n * - CapnwebError (base)\n *   - ConnectionError: Connection failures, disconnections\n *   - RpcError: Method call failures, server errors\n *   - CapabilityError: Capability resolution failures\n *   - TimeoutError: Request timeout exceeded\n *   - SerializationError: Encoding/decoding failures\n *\n * @example\n * ```typescript\n * try {\n *   await client.call('someMethod');\n * } catch (error) {\n *   if (error instanceof CapnwebError) {\n *     console.log(`RPC error [${error.code}]: ${error.message}`);\n *   }\n * }\n * ```\n */\nexport class CapnwebError extends Error {\n  /**\n   * Creates a new CapnwebError.\n   * @param message - Human-readable error message\n   * @param code - Numeric error code (e.g., 1001, 2001)\n   * @param codeName - String name of the error code (e.g., 'CONNECTION_ERROR')\n   */\n  constructor(\n    message: string,\n    public readonly code: ErrorCodeType,\n    public readonly codeName: string\n  ) {\n    super(message);\n    this.name = 'CapnwebError';\n  }\n\n  /**\n   * Returns a JSON representation of the error.\n   */\n  toJSON(): { name: string; message: string; code: number; codeName: string } {\n    return {\n      name: this.name,\n      message: this.message,\n      code: this.code,\n      codeName: this.codeName,\n    };\n  }\n}\n\n/**\n * Error thrown when a connection cannot be established or is unexpectedly lost.\n *\n * Error Code: 1001 (CONNECTION_ERROR)\n *\n * Common causes:\n * - Network unreachable or server down\n * - TLS/certificate errors\n * - Connection timeout during handshake\n * - Server closed connection unexpectedly\n *\n * @example\n * ```typescript\n * try {\n *   await connect('wss://api.example.do');\n * } catch (error) {\n *   if (error instanceof ConnectionError) {\n *     console.log('Failed to connect:', error.message);\n *     // Retry logic here\n *   }\n * }\n * ```\n */\nexport class ConnectionError extends CapnwebError {\n  /**\n   * Creates a new ConnectionError.\n   * @param message - Description of the connection failure\n   */\n  constructor(message: string) {\n    super(message, ErrorCode.CONNECTION_ERROR, 'CONNECTION_ERROR');\n    this.name = 'ConnectionError';\n  }\n}\n\n/**\n * Error thrown when an RPC method call fails.\n *\n * Error Code: 2001 (RPC_ERROR)\n *\n * Common causes:\n * - Method not found on the remote server\n * - Invalid arguments passed to the method\n * - Server-side exception during method execution\n * - Permission denied for the requested operation\n *\n * @example\n * ```typescript\n * try {\n *   await client.call('processData', data);\n * } catch (error) {\n *   if (error instanceof RpcError) {\n *     console.log(`RPC call failed: ${error.message}`);\n *     if (error.methodId !== undefined) {\n *       console.log(`Method ID: ${error.methodId}`);\n *     }\n *   }\n * }\n * ```\n */\nexport class RpcError extends CapnwebError {\n  /**\n   * Creates a new RpcError.\n   * @param message - Description of the RPC failure\n   * @param methodId - Optional method ID that failed (for debugging)\n   */\n  constructor(\n    message: string,\n    public readonly methodId?: number\n  ) {\n    super(message, ErrorCode.RPC_ERROR, 'RPC_ERROR');\n    this.name = 'RpcError';\n  }\n}\n\n/**\n * Error thrown when an operation exceeds its timeout.\n *\n * Error Code: 3001 (TIMEOUT_ERROR)\n *\n * Common causes:\n * - Server is slow or overloaded\n * - Network latency issues\n * - Method taking longer than expected to complete\n * - Deadlock or infinite loop on the server\n *\n * @example\n * ```typescript\n * try {\n *   await client.call('longRunningOperation', { timeout: 5000 });\n * } catch (error) {\n *   if (error instanceof TimeoutError) {\n *     console.log('Operation timed out:', error.message);\n *     // Consider retrying with a longer timeout\n *   }\n * }\n * ```\n */\nexport class TimeoutError extends CapnwebError {\n  /**\n   * Creates a new TimeoutError.\n   * @param message - Description of what timed out (default: 'Request timed out')\n   * @param timeoutMs - The timeout duration in milliseconds\n   */\n  constructor(\n    message: string = 'Request timed out',\n    public readonly timeoutMs?: number\n  ) {\n    super(message, ErrorCode.TIMEOUT_ERROR, 'TIMEOUT_ERROR');\n    this.name = 'TimeoutError';\n  }\n}\n\n/**\n * Error thrown when a capability cannot be resolved or is invalid.\n *\n * Error Code: 4001 (CAPABILITY_ERROR)\n *\n * Common causes:\n * - Capability reference expired or was garbage collected\n * - Capability was revoked by the server\n * - Invalid capability ID provided\n * - Capability not found in the import table\n *\n * @example\n * ```typescript\n * try {\n *   const counter = await client.call('getCounter');\n *   await counter.increment(1);\n * } catch (error) {\n *   if (error instanceof CapabilityError) {\n *     console.log(`Capability error: ${error.message}`);\n *     if (error.capabilityId !== undefined) {\n *       console.log(`Capability ID: ${error.capabilityId}`);\n *     }\n *   }\n * }\n * ```\n */\nexport class CapabilityError extends CapnwebError {\n  /**\n   * Creates a new CapabilityError.\n   * @param message - Description of the capability error\n   * @param capabilityId - Optional ID of the capability that caused the error\n   */\n  constructor(\n    message: string,\n    public readonly capabilityId?: CapabilityId\n  ) {\n    super(message, ErrorCode.CAPABILITY_ERROR, 'CAPABILITY_ERROR');\n    this.name = 'CapabilityError';\n  }\n}\n\n/**\n * Error thrown when serialization or deserialization fails.\n *\n * Error Code: 5001 (SERIALIZATION_ERROR)\n *\n * Common causes:\n * - Invalid data format\n * - Schema mismatch between client and server\n * - Corrupted message data\n * - Unsupported data types\n *\n * @example\n * ```typescript\n * try {\n *   await client.call('processData', complexObject);\n * } catch (error) {\n *   if (error instanceof SerializationError) {\n *     console.log('Serialization failed:', error.message);\n *   }\n * }\n * ```\n */\nexport class SerializationError extends CapnwebError {\n  /**\n   * Creates a new SerializationError.\n   * @param message - Description of the serialization failure\n   * @param isDeserialize - Whether this was a deserialization (vs serialization) error\n   */\n  constructor(\n    message: string,\n    public readonly isDeserialize: boolean = false\n  ) {\n    super(message, ErrorCode.SERIALIZATION_ERROR, 'SERIALIZATION_ERROR');\n    this.name = 'SerializationError';\n  }\n}\n\n// ============================================================================\n// Error Utilities\n// ============================================================================\n\n/**\n * Checks if an error is a CapnwebError with a specific error code.\n *\n * @param error - The error to check\n * @param code - The error code to match\n * @returns true if the error matches the code\n *\n * @example\n * ```typescript\n * try {\n *   await client.call('method');\n * } catch (error) {\n *   if (isErrorCode(error, ErrorCode.TIMEOUT_ERROR)) {\n *     // Handle timeout specifically\n *   }\n * }\n * ```\n */\nexport function isErrorCode(error: unknown, code: ErrorCodeType): boolean {\n  return error instanceof CapnwebError && error.code === code;\n}\n\n/**\n * Creates an appropriate CapnwebError subclass from an error code and message.\n *\n * @param code - The error code\n * @param message - The error message\n * @returns An instance of the appropriate error class\n */\nexport function createError(code: ErrorCodeType, message: string): CapnwebError {\n  switch (code) {\n    case ErrorCode.CONNECTION_ERROR:\n      return new ConnectionError(message);\n    case ErrorCode.RPC_ERROR:\n      return new RpcError(message);\n    case ErrorCode.TIMEOUT_ERROR:\n      return new TimeoutError(message);\n    case ErrorCode.CAPABILITY_ERROR:\n      return new CapabilityError(message);\n    case ErrorCode.SERIALIZATION_ERROR:\n      return new SerializationError(message);\n    default:\n      return new CapnwebError(message, code, ErrorCodeName[code] || 'UNKNOWN_ERROR');\n  }\n}\n\n/**\n * Wraps an unknown error into a CapnwebError.\n *\n * @param error - Any error or thrown value\n * @param defaultCode - The default error code if not a CapnwebError\n * @returns A CapnwebError instance\n */\nexport function wrapError(\n  error: unknown,\n  defaultCode: ErrorCodeType = ErrorCode.RPC_ERROR\n): CapnwebError {\n  if (error instanceof CapnwebError) {\n    return error;\n  }\n  if (error instanceof Error) {\n    return createError(defaultCode, error.message);\n  }\n  return createError(defaultCode, String(error));\n}\n"]}